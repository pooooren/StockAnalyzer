<!doctype html>
<html lang="en">
<head>
    <script type="text/javascript" src="js/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="js/highstock.js"></script>
    <script type="text/javascript" src="js/modules/exporting.js"></script>
    <script>
        $(function () {

			$("#startdateradio").click(function(){
				var ss=$("input[name='startdate']:checked").val();
				$("#start").val(ss);
			});
			
            $("#GoButton").click(function () {
                var stock = $("#stock").val();
                var url = "/rest/rest/info/id/" + stock;
                $.ajaxSetup({ async: false });
                var t = $.getJSON(url);
                var weight = t.responseJSON["weight"];
                $("#BigSelect").empty();
                $("#BigSelect").append("<option>" + 500 * weight + "</option><option  selected='selected'>" + 1000 * weight + "</option><option>" + 2000 * weight + "</option>");
                					var name=t.responseJSON["name"];
					var namestring="<a href='http://stockpage.10jqka.com.cn/"+stock.substring(2)+"'>"+name+"</a>";
					
                    $("#name").html(namestring);

                var first = t.responseJSON["firstlevel"];
                var second = t.responseJSON["secondlevel"];
                var location = t.responseJSON["location"];
                $('#industry1').attr('href', '/web/company.html?industry1=' + first);
                $('#industry1').text(first);

                $('#industry2').attr('href', '/web/company.html?industry1=' + first + '&industry2=' + second);
                $('#industry2').text(second);

                $('#location').attr('href', '/web/company.html?location=' + location);
                $('#location').text(location);
            });

            $("#QueryButton").click(function () {
                show();
            });

            var u = decodeURIComponent(window.location.href);
            var par = u.substring(u.lastIndexOf('?') + 1, u.length);
            var d = par.split('&');
            var sid = "", big = "";
            for (var i = 0; i < d.length; i++) {
                var keyValue = d[i].split('=');
                var key = keyValue[0];
                var value = keyValue[1];
                if (key == "sid") sid = value;
                if (key == "big") big = value;
            }


            $("#stock").val(sid);
            $("#BigSelect").empty();
            $("#BigSelect").append("<option  selected='selected'>" + big + "</option>");

            show();

            function show() {
                var seriesOptions,
                      yAxisOptions = [],
                      seriesCounter = 0,

                      colors = Highcharts.getOptions().colors;

                var stock = $("#stock").val();
                var type = $("#TypeSelect  option:selected").text();
                var big = $("#BigSelect  option:selected").text();
                var start = $("#start").val();

                var tag = [];
                var totalshare = [];
                var sellshare = [];
                var buyshare = [];
                var incrementalBuyMoney = [];
                var incrementalSellMoney = [];
                var diff = [];
                var close = [];

                $.ajaxSetup({ async: false });
                var url = "/rest/rest/query/id/" + stock + "?big=" + big + "&type=" + type + "&start=" + start;
                var t = $.getJSON(url);
                for (var i in t.responseJSON) {
                    tag[i] = t.responseJSON[i]["tag"];
                    totalshare[i] = t.responseJSON[i]["totalshare"];
                    sellshare[i] = t.responseJSON[i]["sellshare"];
                    buyshare[i] = t.responseJSON[i]["buyshare"];
                    incrementalBuyMoney[i] = t.responseJSON[i]["incrementalBuyMoney"];
                    incrementalSellMoney[i] = t.responseJSON[i]["incrementalSellMoney"];
                    diff[i] = incrementalBuyMoney[i] - incrementalSellMoney[i];
                    close[i] = t.responseJSON[i]["close"];
                }


                seriesOptions = {
                    name: "test",
                    data: totalshare
                };

                $('#container').highcharts({
                    chart: {
                        zoomType: 'xy'
                    },
                    title: {
                        text: 'analyze chart',
                        x: -20 //center
                    },
                    subtitle: {
                        text: '',
                        x: -20
                    },
                    xAxis: {
                        categories: tag
                    },
                    yAxis: [{
                        //labels: {
                        //    format: '{value}s',
                        //    style: {
                        //        color: '#89A54E'
                        //    }
                        //},
                        title: {
                            text: 'trade data'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    }, //first Y
                    {
                        //labels: {
                        //    format: '{value}',
                        //    style: {
                        //        color: '#89A54E'
                        //    }
                        //},
                        title: {
                            text: 'price'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }],
                        opposite: true
                    } //second Y

                    ],
                    tooltip: {
                        shared: true
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'left',
                        x: 120,
                        verticalAlign: 'top',
                        y: 100,
                        floating: true,
                        backgroundColor: '#FFFFFF'
                    },
                    series: [{
                        name: 's',
                        yAxis: 0,
                        type:'column',
                        data: sellshare,
						color:'green'
                    }, {
                        name: 'b',
                        yAxis: 0,
                        type:'column',
                        data: buyshare,
						color:'red'
                    },
                    {
                        name: 'close',
                        yAxis: 1,
                        type:'line',
                        data: close,
						color:'blue'
                    }]
                }); //high chart1

                $('#container2').highcharts({
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'diff money chart',
                        x: -20 //center
                    },
                    subtitle: {
                        text: '',
                        x: -20
                    },
                    xAxis: {
                        categories: tag
                    },
                    yAxis: {
                        title: {
                            text: '10kRMB'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        valueSuffix: 'WY'
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle',
                        borderWidth: 0
                    },
                    series: [
                    {
                        name: 'diff',
                        data: diff,
						color:'blue'
                    }
                    ]
                });//high chart 2
  
            };//show
            });//all

    </script>
</head>
<body>
    <div id="input">
        <input id="stock" type="text" />
        <input id="start" type="text" value="20140101" />
        <select id="TypeSelect"><option>w</option><option>m</option><option>d</option></select>
        <select id="BigSelect"><!--<option>2000</option><option>1000</option><option>500</option><option>3000</option><option>4000</option><option>750</option><option>1500</option>--></select>
        <input id="GoButton" type="button" value="GetInfo" />
        <input id="QueryButton" type="button" value="Query" />

        <label id="name"></label>
        <a id="industry1" target='_parent' href=""></a>
        <a id="industry2" target='_parent' href=""></a>
        <a id="location" target='_parent' href=""></a>
		<div id="startdateradio">
			<input type="radio" name="startdate" value="20130101" checked="checked"> 20130101</input>
			<input type="radio" name="startdate" value="20140101" >20140101</input>
			<input type="radio" name="startdate" value="20140601" >20140601</input>
		</div>
    </div>

    <div id="container" style="min-width:500px;height:300px"></div>
    <div id="container2" style="min-width:500px;height:300px"></div>
</body>
</html>